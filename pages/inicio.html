<!DOCTYPE html>

<html lang="es">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Herramienta de contralor√≠a social para la consevacion de la biodiversidad - Protecci√≥n de Fauna Silvestre Tamaulipas</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#4D8143">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ProNatura">
    <meta name="description" content="Sistema de registro ambiental y control social para la conservaci√≥n de la biodiversidad">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="../manifest.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="../assets/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="72x72" href="../assets/icons/icon-72x72.png">
    <link rel="apple-touch-icon" sizes="96x96" href="../assets/icons/icon-96x96.png">
    <link rel="apple-touch-icon" sizes="128x128" href="../assets/icons/icon-128x128.png">
    <link rel="apple-touch-icon" sizes="152x152" href="../assets/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="192x192" href="../assets/icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="384x384" href="../assets/icons/icon-384x384.png">
    <link rel="apple-touch-icon" sizes="512x512" href="../assets/icons/icon-512x512.png">
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3Eüåø%3C/text%3E%3C/svg%3E">
    <link rel="stylesheet" href="../assets/css/styles.css" id="cssLink">
    <script>
        // LIMPIAR SESI√ìN INMEDIATAMENTE - Esto debe ejecutarse ANTES de cualquier otro c√≥digo
        // para asegurar que inicio.html siempre aparezca sin sesi√≥n guardada
        (function() {
            try {
                sessionStorage.removeItem('current_session');
                localStorage.removeItem('current_session');
                sessionStorage.removeItem('index_acceso_permitido'); // Limpiar flag de acceso permitido
                console.log('üßπ Sesi√≥n limpiada INMEDIATAMENTE al cargar inicio.html');
            } catch (error) {
                console.error('‚ùå Error al limpiar sesi√≥n:', error);
            }
        })();

        // Corregir ruta del CSS para Hostinger
        (function() {
            var currentUrl = window.location.href.toLowerCase();
            var cssLink = document.getElementById('cssLink');
            if (cssLink && (currentUrl.indexOf('hostinger') !== -1 || 
                           currentUrl.indexOf('hostingersite.com') !== -1 ||
                           currentUrl.indexOf('organicjournal.com.mx') !== -1)) {
                cssLink.href = '/assets/css/styles.css';
            }
        })();
    </script>

    <style>

        .landing-page {

            min-height: 100vh;

            background: linear-gradient(135deg, #4D8143 0%, #4D8143 100%);

            color: white;

            display: flex;

            flex-direction: column;

            align-items: center;

            justify-content: center;

            padding: 2rem;

            text-align: center;

        }

        

        .landing-title {

            font-size: 3rem;

            margin-bottom: 1rem;

            font-weight: 700;

        }

        

        .landing-subtitle {

            font-size: 1.5rem;

            margin-bottom: 4rem;

            opacity: 0.9;

        }

        

        .how-it-works {

            background: white;

            color: #333;

            padding: 4rem 2rem;

            width: 100%;

            max-width: 1200px;

            border-radius: 12px;

            margin-bottom: 3rem;

        }

        

        .how-it-works h2 {

            font-size: 2.5rem;

            margin-bottom: 3rem;

            color: #4D8143;

        }

        

        .steps-container {

            display: grid;

            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));

            gap: 3rem;

            margin-bottom: 3rem;

        }

        

        .step {

            display: flex;

            flex-direction: column;

            align-items: center;

            text-align: center;

        }

        

        .step-number {

            width: 60px;

            height: 60px;

            border-radius: 50%;

            background: #e0e0e0;

            display: flex;

            align-items: center;

            justify-content: center;

            font-size: 2rem;

            font-weight: 600;

            margin-bottom: 1.5rem;

            color: #333;

        }

        

        .step h3 {

            font-size: 1.5rem;

            margin-bottom: 1rem;

            color: #4D8143;

        }

        

        .step p {

            font-size: 1.1rem;

            color: #666;

            line-height: 1.6;

        }

        

        .cta-section {

            margin-top: 3rem;

        }

        

        .cta-question {

            font-size: 1.8rem;

            margin-bottom: 2rem;

            color: white;

        }

        

        .cta-button {

            padding: 1rem 3rem;

            background: #4D8143;

            color: white;

            border: none;

            border-radius: 25px;

            font-size: 1.2rem;

            font-weight: 600;

            cursor: pointer;

            transition: all 0.3s;

            text-decoration: none;

            display: inline-block;

            position: relative;

            z-index: 10;

            pointer-events: auto;

        }

        

        .cta-button:hover {

            background: #4e2f07;

            transform: translateY(-3px);

            box-shadow: 0 5px 15px rgba(0,0,0,0.3);

        }

        .admin-link {
            margin-top: 2rem;
            text-align: center;
        }

        .admin-link a {
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }

        .admin-link a:hover {
            color: white;
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        /* Estilos para el modal de verificaci√≥n de email */
        .email-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }

        .email-modal.show {
            display: flex;
        }

        .email-modal-content {
            background: white;
            border-radius: 12px;
            padding: 2.5rem;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            text-align: center;
        }

        .email-modal-content h2 {
            color: #4D8143;
            margin-bottom: 1rem;
            font-size: 1.8rem;
        }

        .email-modal-content p {
            color: #666;
            margin-bottom: 1.5rem;
        }

        .email-modal-content input {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 1rem;
            box-sizing: border-box;
        }

        .email-modal-content input:focus {
            outline: none;
            border-color: #4D8143;
        }

        .email-modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .email-modal-buttons button {
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .email-modal-buttons .btn-primary {
            background: #4D8143;
            color: white;
        }

        .email-modal-buttons .btn-primary:hover {
            background: #3d6a35;
        }

        .email-modal-buttons .btn-primary:disabled {
            background: #9e9e9e;
            cursor: not-allowed;
        }

        .email-modal-buttons .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .email-modal-buttons .btn-secondary:hover {
            background: #d0d0d0;
        }

        .email-modal .error-message {
            background: #fee;
            color: #c33;
            padding: 0.8rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }

        .email-modal .error-message.show {
            display: block;
        }

        .email-modal .loading {
            display: none;
            color: #4D8143;
            margin-top: 1rem;
            font-weight: 600;
        }

        .email-modal .loading.show {
            display: block;
        }

        .email-modal-content input[readonly] {
            background-color: #f5f5f5;
            cursor: not-allowed;
        }

        #loginView input {
            margin-bottom: 1rem;
        }

        /* Estilos para ver/ocultar contrase√±a */
        .password-wrapper {
            position: relative;
            width: 100%;
        }

        .password-wrapper input {
            padding-right: 45px;
            width: 100%;
            box-sizing: border-box;
        }

        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            color: #666;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.3s;
        }

        .password-toggle:hover {
            color: #4D8143;
        }

        .password-toggle:focus {
            outline: none;
        }

        /* Responsive para m√≥viles */
        @media (max-width: 768px) {
            .landing-page {
                padding: 1rem;
            }

            .landing-title {
                font-size: 1.8rem;
                margin-bottom: 0.5rem;
            }

            .landing-subtitle {
                font-size: 1.1rem;
                margin-bottom: 2rem;
            }

            .how-it-works {
                padding: 2rem 1rem;
                margin-bottom: 2rem;
            }

            .how-it-works h2 {
                font-size: 1.8rem;
                margin-bottom: 2rem;
            }

            .steps-container {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .step-number {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }

            .step h3 {
                font-size: 1.2rem;
            }

            .step p {
                font-size: 1rem;
            }

            .cta-question {
                font-size: 1.3rem;
                margin-bottom: 1.5rem;
            }

            .cta-button {
                padding: 0.9rem 2rem;
                font-size: 1rem;
                width: 100%;
                max-width: 300px;
            }

            .email-modal-content {
                padding: 1.5rem;
                max-width: 95%;
                width: 95%;
            }

            .email-modal-content h2 {
                font-size: 1.5rem;
            }

            .email-modal-content input {
                font-size: 16px; /* Previene zoom en iOS */
            }

            .email-modal-buttons {
                flex-direction: column;
            }

            .email-modal-buttons button {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .landing-title {
                font-size: 1.5rem;
            }

            .landing-subtitle {
                font-size: 1rem;
            }

            .how-it-works {
                padding: 1.5rem 0.8rem;
            }

            .how-it-works h2 {
                font-size: 1.5rem;
            }

            .step-number {
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
            }

            .cta-button {
                padding: 0.8rem 1.5rem;
                font-size: 0.95rem;
            }
        }

    </style>

</head>

<body>

    <div class="landing-page">

        <h1 class="landing-title">Herramienta de contralor√≠a social para la consevacion de la biodiversidad</h1>

        <p class="landing-subtitle">Protecci√≥n de Fauna Silvestre de Tamaulipas</p>

        

        <div class="how-it-works">

            <h2>C√≥mo Funciona</h2>

            

            <div class="steps-container">

                <div class="step">

                    <div class="step-number">1</div>

                    <h3>Registra tu Reporte</h3>

                    <p>A√±ade tu nombre, tipo de Reporte, fecha y cualquier nota relevante y una breve descripcion tecnica.</p>

                </div>

                

                <div class="step">

                    <div class="step-number">2</div>

                    <h3>Ubica en el mapa</h3>

                    <p>Marca la ubicaci√≥n exacta.</p>

                </div>

                

                <div class="step">

                    <div class="step-number">3</div>

                    <h3>Consulta tu cat√°logo</h3>

                    <p>Revisa y administra todos tus registros en cualquier momento.</p>

                </div>

            </div>

        </div>

        

        <div class="cta-section">

            <p class="cta-question">¬øListo para comenzar a registrar?</p>

            <button type="button" class="cta-button" id="loginButton">Comenzar</button>

            <div class="admin-link">
                <a href="admin-login.html">
                    <span>‚öôÔ∏è</span>
                    <span>Acceso Administrador</span>
                </a>
            </div>

        </div>

    </div>

    <!-- Modal de verificaci√≥n de email -->
    <div id="emailModal" class="email-modal">
        <div class="email-modal-content">
            <!-- Vista de verificaci√≥n de email -->
            <div id="emailVerificationView">
                <h2>¬øYa tienes cuenta?</h2>
                <p>Ingresa tu correo electr√≥nico para continuar</p>
                <div id="emailModalError" class="error-message"></div>
                <div id="emailModalLoading" class="loading">Verificando...</div>
                <input type="email" id="emailInput" placeholder="correo@ejemplo.com" autocomplete="email">
                <div class="email-modal-buttons">
                    <button type="button" class="btn-primary" id="verifyEmailBtn">Continuar</button>
                    <button type="button" class="btn-secondary" id="cancelEmailBtn">Cancelar</button>
                </div>
            </div>
            
            <!-- Vista de inicio de sesi√≥n (se muestra cuando el email existe) -->
            <div id="loginView" style="display: none;">
                <h2>Iniciar Sesi√≥n</h2>
                <p>Ingresa tu contrase√±a para continuar</p>
                <div id="loginModalError" class="error-message"></div>
                <div id="loginModalLoading" class="loading">Iniciando sesi√≥n...</div>
                <input type="email" id="loginEmailInput" readonly style="background-color: #f5f5f5; cursor: not-allowed;">
                <div class="password-wrapper">
                    <input type="password" id="loginPasswordInput" placeholder="Contrase√±a" autocomplete="current-password">
                    <button type="button" class="password-toggle" onclick="togglePassword('loginPasswordInput', this)" aria-label="Mostrar contrase√±a">
                        üëÅÔ∏è
                    </button>
                </div>
                <div style="margin-bottom: 1rem; text-align: center;">
                    <a href="recuperar-contrase√±a.html" style="color: #666; font-size: 0.9rem; text-decoration: none;">¬øOlvidaste tu contrase√±a?</a>
                </div>
                <div class="email-modal-buttons">
                    <button type="button" class="btn-primary" id="loginSubmitBtn">Iniciar Sesi√≥n</button>
                    <button type="button" class="btn-secondary" id="backToEmailBtn">Volver</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Limpiar sesi√≥n INMEDIATAMENTE al cargar inicio.html para que siempre aparezca sin sesi√≥n guardada
        // Esto debe ejecutarse ANTES de cualquier otro script
        (function() {
            try {
                sessionStorage.removeItem('current_session');
                localStorage.removeItem('current_session'); // Limpiar tambi√©n localStorage por compatibilidad
                console.log('üßπ Sesi√≥n limpiada al cargar inicio.html');
            } catch (error) {
                console.error('‚ùå Error al limpiar sesi√≥n:', error);
            }
        })();

        // Cargar auth.js con detecci√≥n de entorno
        (function() {
            var currentUrl = window.location.href.toLowerCase();
            var isHostinger = currentUrl.indexOf('hostinger') !== -1 || 
                             currentUrl.indexOf('hostingersite.com') !== -1 ||
                             currentUrl.indexOf('organicjournal.com.mx') !== -1;
            
            var script = document.createElement('script');
            script.id = 'authScript';
            
            if (isHostinger) {
                // Usar ruta absoluta desde la ra√≠z del dominio
                script.src = '/assets/js/auth.js?v=' + Date.now();
            } else {
                script.src = '../assets/js/auth.js';
            }
            
            script.onerror = function() {
                console.error('‚ùå Error al cargar auth.js desde:', script.src);
            };
            
            script.onload = function() {
                console.log('‚úÖ auth.js cargado correctamente desde:', script.src);
                
                // Limpiar sesi√≥n nuevamente despu√©s de cargar auth.js para asegurar que no haya sesi√≥n guardada
                try {
                    sessionStorage.removeItem('current_session');
                    localStorage.removeItem('current_session');
                    console.log('üßπ Sesi√≥n limpiada nuevamente despu√©s de cargar auth.js');
                } catch (error) {
                    console.error('‚ùå Error al limpiar sesi√≥n despu√©s de cargar auth.js:', error);
                }
                
                if (window.authSystem) {
                    console.log('‚úÖ authSystem disponible');
                    console.log('‚úÖ M√©todos disponibles:', Object.keys(window.authSystem));
                    if (typeof window.authSystem.checkEmail === 'function') {
                        console.log('‚úÖ checkEmail est√° disponible');
                    } else {
                        console.error('‚ùå checkEmail NO est√° disponible');
                    }
                } else {
                    console.error('‚ùå authSystem NO est√° disponible despu√©s de cargar');
                }
            };
            
            document.head.appendChild(script);
        })();
    </script>

    <script>
        // DETECCI√ìN DE ENTORNO Y NAVEGACI√ìN CON VERIFICACI√ìN DE EMAIL
        (function() {
            'use strict';
            
            // Funci√≥n para detectar si estamos en Hostinger
            function isHostinger() {
                var currentUrl = window.location.href.toLowerCase();
                return currentUrl.indexOf('hostinger') !== -1 || 
                       currentUrl.indexOf('hostingersite.com') !== -1 ||
                       currentUrl.indexOf('organicjournal.com.mx') !== -1;
            }
            
            // Funci√≥n para obtener la ruta correcta de login
            function getLoginPath() {
                var currentPath = window.location.pathname;
                var isInPages = currentPath.indexOf('/pages/') !== -1;
                
                if (isHostinger()) {
                    return 'login.html';
                } else {
                    if (isInPages) {
                        return 'login.html';
                    } else {
                        return 'pages/login.html';
                    }
                }
            }
            
            // Funci√≥n para obtener la ruta correcta de registro
            function getRegistroPath() {
                var currentPath = window.location.pathname;
                var isInPages = currentPath.indexOf('/pages/') !== -1;
                
                if (isHostinger()) {
                    return 'registro.html';
                } else {
                    if (isInPages) {
                        return 'registro.html';
                    } else {
                        return 'pages/registro.html';
                    }
                }
            }
            
            // Funci√≥n para navegar al login con email prellenado
            function navigateToLogin(email) {
                try {
                    console.log('üöÄ Navegando al login con email:', email);
                    sessionStorage.setItem('allowLoginAccess', 'true');
                    if (email) {
                        sessionStorage.setItem('prefillEmail', email);
                    }
                    var loginPath = getLoginPath();
                    window.location.href = loginPath;
                } catch (error) {
                    console.error('‚ùå Error al navegar:', error);
                    window.location.href = getLoginPath();
                }
            }
            
            // Funci√≥n para navegar al registro con email prellenado
            function navigateToRegistro(email) {
                try {
                    console.log('üöÄ Navegando al registro con email:', email);
                    if (email) {
                        sessionStorage.setItem('prefillEmail', email);
                    }
                    var registroPath = getRegistroPath();
                    window.location.href = registroPath;
                } catch (error) {
                    console.error('‚ùå Error al navegar:', error);
                    window.location.href = getRegistroPath();
                }
            }
            
            // Funci√≥n para mostrar el modal de verificaci√≥n
            function showEmailModal() {
                var modal = document.getElementById('emailModal');
                var emailInput = document.getElementById('emailInput');
                var errorDiv = document.getElementById('emailModalError');
                var loadingDiv = document.getElementById('emailModalLoading');
                var emailVerificationView = document.getElementById('emailVerificationView');
                var loginView = document.getElementById('loginView');
                var loginErrorDiv = document.getElementById('loginModalError');
                var loginLoadingDiv = document.getElementById('loginModalLoading');
                var loginSubmitBtn = document.getElementById('loginSubmitBtn');
                var loginPasswordInput = document.getElementById('loginPasswordInput');
                
                // Resetear el flag de permiso cuando se muestra el modal
                if (window.resetPermisoGuardarSesion) {
                    window.resetPermisoGuardarSesion();
                }
                
                if (modal) {
                    modal.classList.add('show');
                    errorDiv.classList.remove('show');
                    loadingDiv.classList.remove('show');
                    emailInput.value = '';
                    emailInput.focus();
                    
                    // Limpiar estado del login
                    if (loginErrorDiv) {
                        loginErrorDiv.textContent = '';
                        loginErrorDiv.classList.remove('show');
                    }
                    if (loginLoadingDiv) loginLoadingDiv.classList.remove('show');
                    if (loginSubmitBtn) {
                        loginSubmitBtn.disabled = false;
                        loginSubmitBtn.textContent = 'Iniciar Sesi√≥n';
                    }
                    if (loginPasswordInput) {
                        loginPasswordInput.value = '';
                    }
                    
                    // Mostrar vista de verificaci√≥n y ocultar vista de login
                    if (emailVerificationView) emailVerificationView.style.display = 'block';
                    if (loginView) loginView.style.display = 'none';
                }
            }
            
            // Funci√≥n para ocultar el modal
            function hideEmailModal() {
                var modal = document.getElementById('emailModal');
                var errorDiv = document.getElementById('emailModalError');
                var loadingDiv = document.getElementById('emailModalLoading');
                var loginErrorDiv = document.getElementById('loginModalError');
                var loginLoadingDiv = document.getElementById('loginModalLoading');
                var emailVerificationView = document.getElementById('emailVerificationView');
                var loginView = document.getElementById('loginView');
                var loginSubmitBtn = document.getElementById('loginSubmitBtn');
                var loginPasswordInput = document.getElementById('loginPasswordInput');
                var emailInput = document.getElementById('emailInput');
                
                if (modal) {
                    modal.classList.remove('show');
                    errorDiv.classList.remove('show');
                    loadingDiv.classList.remove('show');
                    
                    // Limpiar estado del login
                    if (loginErrorDiv) {
                        loginErrorDiv.textContent = '';
                        loginErrorDiv.classList.remove('show');
                    }
                    if (loginLoadingDiv) loginLoadingDiv.classList.remove('show');
                    if (loginSubmitBtn) {
                        loginSubmitBtn.disabled = false;
                        loginSubmitBtn.textContent = 'Iniciar Sesi√≥n';
                    }
                    if (loginPasswordInput) {
                        loginPasswordInput.value = '';
                    }
                    if (emailInput) {
                        emailInput.value = '';
                    }
                    
                    // Resetear vistas
                    if (emailVerificationView) emailVerificationView.style.display = 'block';
                    if (loginView) loginView.style.display = 'none';
                }
            }
            
            // Funci√≥n para mostrar la vista de login
            function showLoginView(email) {
                var emailVerificationView = document.getElementById('emailVerificationView');
                var loginView = document.getElementById('loginView');
                var loginEmailInput = document.getElementById('loginEmailInput');
                var loginPasswordInput = document.getElementById('loginPasswordInput');
                var loginErrorDiv = document.getElementById('loginModalError');
                var loginLoadingDiv = document.getElementById('loginModalLoading');
                var loginSubmitBtn = document.getElementById('loginSubmitBtn');
                
                // Resetear el flag de permiso cuando se muestra el modal de nuevo
                // Esto asegura que cada intento de login tenga que activar el permiso nuevamente
                if (window.resetPermisoGuardarSesion) {
                    window.resetPermisoGuardarSesion();
                }
                
                if (emailVerificationView) emailVerificationView.style.display = 'none';
                if (loginView) loginView.style.display = 'block';
                if (loginEmailInput) loginEmailInput.value = email;
                if (loginPasswordInput) {
                    loginPasswordInput.value = '';
                    loginPasswordInput.focus();
                }
                // Limpiar errores y estado del bot√≥n
                if (loginErrorDiv) {
                    loginErrorDiv.textContent = '';
                    loginErrorDiv.classList.remove('show');
                }
                if (loginLoadingDiv) loginLoadingDiv.classList.remove('show');
                // Asegurar que el bot√≥n est√© habilitado y con el texto correcto
                if (loginSubmitBtn) {
                    loginSubmitBtn.disabled = false;
                    loginSubmitBtn.textContent = 'Iniciar Sesi√≥n';
                }
            }
            
            // Funci√≥n para procesar el login desde el modal
            async function processLoginFromModal() {
                var loginEmailInput = document.getElementById('loginEmailInput');
                var loginPasswordInput = document.getElementById('loginPasswordInput');
                var loginErrorDiv = document.getElementById('loginModalError');
                var loginLoadingDiv = document.getElementById('loginModalLoading');
                var loginSubmitBtn = document.getElementById('loginSubmitBtn');
                
                var email = loginEmailInput ? loginEmailInput.value.trim() : '';
                var password = loginPasswordInput ? loginPasswordInput.value : '';
                
                // Validar campos
                if (!password) {
                    if (loginErrorDiv) {
                        loginErrorDiv.textContent = 'Por favor ingresa tu contrase√±a';
                        loginErrorDiv.classList.add('show');
                    }
                    return;
                }
                
                // Ocultar error y mostrar loading
                if (loginErrorDiv) loginErrorDiv.classList.remove('show');
                if (loginLoadingDiv) loginLoadingDiv.classList.add('show');
                if (loginSubmitBtn) {
                    loginSubmitBtn.disabled = true;
                    loginSubmitBtn.textContent = 'Iniciando sesi√≥n...';
                }
                
                try {
                    // Esperar a que authSystem est√© disponible
                    if (!window.authSystem) {
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                    
                    if (!window.authSystem) {
                        throw new Error('Sistema de autenticaci√≥n no disponible');
                    }
                    
                    // IMPORTANTE: Activar permiso ANTES de llamar a login()
                    // porque login() internamente llama a setSession() que es interceptado
                    if (window.permitirGuardarSesionEnInicio) {
                        window.permitirGuardarSesionEnInicio();
                        console.log('‚úÖ Permiso activado ANTES del login');
                    }
                    
                    // Intentar iniciar sesi√≥n
                    console.log('üîê Intentando iniciar sesi√≥n con email:', email);
                    var result = await window.authSystem.login(email, password);
                    console.log('üìã Resultado del login:', result);
                    
                    if (loginLoadingDiv) loginLoadingDiv.classList.remove('show');
                    if (loginSubmitBtn) {
                        loginSubmitBtn.disabled = false;
                        loginSubmitBtn.textContent = 'Iniciar Sesi√≥n';
                    }
                    
                    if (result.success) {
                        // Verificar que la sesi√≥n se haya guardado correctamente
                        let user = window.authSystem.getCurrentUser();
                        
                        if (!user) {
                            await new Promise(resolve => setTimeout(resolve, 200));
                            user = window.authSystem.getCurrentUser();
                        }
                        
                        if (!user) {
                            if (loginErrorDiv) {
                                loginErrorDiv.textContent = 'Error al guardar la sesi√≥n. Intenta nuevamente.';
                                loginErrorDiv.classList.add('show');
                            }
                            // Asegurar que el bot√≥n est√© habilitado
                            if (loginSubmitBtn) {
                                loginSubmitBtn.disabled = false;
                                loginSubmitBtn.textContent = 'Iniciar Sesi√≥n';
                            }
                            return;
                        }
                        
                        console.log('‚úÖ Login exitoso desde modal, usuario:', user);
                        
                        // La sesi√≥n ya deber√≠a estar guardada por login(), pero verificamos
                        // No necesitamos llamar a setSession() de nuevo porque login() ya lo hizo
                        
                        // Esperar un momento adicional para asegurar que sessionStorage se sincronice
                        await new Promise(resolve => setTimeout(resolve, 300));
                        
                        // Verificar una vez m√°s antes de redirigir
                        const finalCheck = window.authSystem.getCurrentUser();
                        if (!finalCheck) {
                            if (loginErrorDiv) {
                                loginErrorDiv.textContent = 'Error cr√≠tico. Por favor recarga la p√°gina e intenta nuevamente.';
                                loginErrorDiv.classList.add('show');
                            }
                            // Asegurar que el bot√≥n est√© habilitado
                            if (loginSubmitBtn) {
                                loginSubmitBtn.disabled = false;
                                loginSubmitBtn.textContent = 'Iniciar Sesi√≥n';
                            }
                            return;
                        }
                        
                        // Si es administrador, ofrecer ir al panel de admin o a la biblioteca
                        if (user && user.rol === 'admin') {
                            if (confirm('¬øDeseas ir al Panel de Administraci√≥n?')) {
                                window.location.href = 'admin.html';
                            } else {
                                // Marcar que viene de login para permitir acceso a index.html
                                sessionStorage.setItem('vieneDeLogin', 'true');
                                window.location.href = 'index.html';
                            }
                        } else {
                            // Marcar que viene de login para permitir acceso a index.html
                            sessionStorage.setItem('vieneDeLogin', 'true');
                            window.location.href = 'index.html';
                        }
                    } else {
                        // Error en el login - asegurar que el bot√≥n est√© habilitado y mostrar error
                        console.log('‚ùå Error en login:', result.message);
                        if (loginErrorDiv) {
                            loginErrorDiv.textContent = result.message || 'Correo o contrase√±a incorrectos';
                            loginErrorDiv.classList.add('show');
                            console.log('‚úÖ Mensaje de error mostrado en el modal');
                        } else {
                            console.error('‚ùå No se encontr√≥ el elemento loginModalError');
                        }
                        // Asegurar que el bot√≥n est√© habilitado
                        if (loginSubmitBtn) {
                            loginSubmitBtn.disabled = false;
                            loginSubmitBtn.textContent = 'Iniciar Sesi√≥n';
                            console.log('‚úÖ Bot√≥n de login habilitado');
                        } else {
                            console.error('‚ùå No se encontr√≥ el bot√≥n loginSubmitBtn');
                        }
                        // Asegurar que el campo de contrase√±a est√© enfocado para facilitar reintento
                        if (loginPasswordInput) {
                            loginPasswordInput.focus();
                            loginPasswordInput.select();
                        }
                    }
                } catch (error) {
                    console.error('Error al iniciar sesi√≥n desde modal:', error);
                    if (loginLoadingDiv) loginLoadingDiv.classList.remove('show');
                    if (loginSubmitBtn) {
                        loginSubmitBtn.disabled = false;
                        loginSubmitBtn.textContent = 'Iniciar Sesi√≥n';
                    }
                    if (loginErrorDiv) {
                        loginErrorDiv.textContent = 'Error de conexi√≥n. Intenta nuevamente.';
                        loginErrorDiv.classList.add('show');
                    }
                }
            }
            
            // Funci√≥n para verificar email y redirigir
            async function verifyEmailAndNavigate() {
                var emailInput = document.getElementById('emailInput');
                var errorDiv = document.getElementById('emailModalError');
                var loadingDiv = document.getElementById('emailModalLoading');
                var verifyBtn = document.getElementById('verifyEmailBtn');
                
                var email = emailInput.value.trim();
                
                // Validar email
                if (!email) {
                    errorDiv.textContent = 'Por favor ingresa tu correo electr√≥nico';
                    errorDiv.classList.add('show');
                    return;
                }
                
                var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    errorDiv.textContent = 'Por favor ingresa un correo electr√≥nico v√°lido';
                    errorDiv.classList.add('show');
                    return;
                }
                
                // Ocultar error y mostrar loading
                errorDiv.classList.remove('show');
                loadingDiv.classList.add('show');
                verifyBtn.disabled = true;
                verifyBtn.textContent = 'Verificando...';
                
                try {
                    // Esperar a que authSystem est√© disponible
                    if (!window.authSystem) {
                        // Esperar un poco m√°s
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                    
                    // Verificar m√∫ltiples veces que authSystem y checkEmail est√©n disponibles
                    let attempts = 0;
                    while ((!window.authSystem || typeof window.authSystem.checkEmail !== 'function') && attempts < 5) {
                        await new Promise(resolve => setTimeout(resolve, 200));
                        attempts++;
                    }
                    
                    if (!window.authSystem) {
                        throw new Error('Sistema de autenticaci√≥n no disponible');
                    }
                    
                    if (typeof window.authSystem.checkEmail !== 'function') {
                        console.error('‚ùå checkEmail no est√° disponible en authSystem');
                        console.error('authSystem disponible:', window.authSystem);
                        console.error('M√©todos disponibles:', Object.keys(window.authSystem || {}));
                        throw new Error('La funci√≥n checkEmail no est√° disponible. Verifica que auth.js se haya cargado correctamente.');
                    }
                    
                    // Verificar si el email existe
                    console.log('üîç Llamando a checkEmail con email:', email);
                    var result = await window.authSystem.checkEmail(email);
                    console.log('üì¶ Resultado de checkEmail:', result);
                    
                    loadingDiv.classList.remove('show');
                    verifyBtn.disabled = false;
                    verifyBtn.textContent = 'Continuar';
                    
                    if (result.success) {
                        if (result.exists) {
                            // Email existe, mostrar formulario de login en el modal
                            console.log('‚úÖ Email existe, mostrando formulario de login');
                            showLoginView(email);
                        } else {
                            // Email no existe, ir a registro
                            console.log('‚ÑπÔ∏è Email no existe, redirigiendo a registro');
                            navigateToRegistro(email);
                        }
                    } else {
                        // Error al verificar
                        errorDiv.textContent = result.message || 'Error al verificar el correo. Intenta nuevamente.';
                        errorDiv.classList.add('show');
                    }
                } catch (error) {
                    console.error('Error al verificar email:', error);
                    loadingDiv.classList.remove('show');
                    verifyBtn.disabled = false;
                    verifyBtn.textContent = 'Continuar';
                    errorDiv.textContent = 'Error de conexi√≥n. Verifica que el servidor est√© corriendo.';
                    errorDiv.classList.add('show');
                }
            }
            
            // Configurar el bot√≥n y el modal cuando el DOM est√© listo
            function setupButtonAndModal() {
                var btn = document.getElementById('loginButton');
                var modal = document.getElementById('emailModal');
                var verifyBtn = document.getElementById('verifyEmailBtn');
                var cancelBtn = document.getElementById('cancelEmailBtn');
                var emailInput = document.getElementById('emailInput');
                
                if (!btn) {
                    console.error('‚ùå Bot√≥n no encontrado, reintentando...');
                    setTimeout(setupButtonAndModal, 100);
                    return;
                }
                
                console.log('‚úÖ Bot√≥n encontrado');
                
                // Configurar click del bot√≥n de inicio de sesi√≥n
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    console.log('üñ±Ô∏è Click detectado en bot√≥n - mostrando modal');
                    showEmailModal();
                    return false;
                }, true);
                
                btn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    console.log('üñ±Ô∏è onclick directo ejecutado - mostrando modal');
                    showEmailModal();
                    return false;
                };
                
                // Configurar bot√≥n de verificar email
                if (verifyBtn) {
                    verifyBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        verifyEmailAndNavigate();
                    });
                }
                
                // Configurar bot√≥n de cancelar
                if (cancelBtn) {
                    cancelBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        hideEmailModal();
                    });
                }
                
                // Permitir Enter en el input de email
                if (emailInput) {
                    emailInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            verifyEmailAndNavigate();
                        }
                    });
                }
                
                // Configurar bot√≥n de login
                var loginSubmitBtn = document.getElementById('loginSubmitBtn');
                if (loginSubmitBtn) {
                    loginSubmitBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        processLoginFromModal();
                    });
                }
                
                // Configurar bot√≥n de volver
                var backToEmailBtn = document.getElementById('backToEmailBtn');
                if (backToEmailBtn) {
                    backToEmailBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        showEmailModal();
                    });
                }
                
                // Permitir Enter en el input de contrase√±a
                var loginPasswordInput = document.getElementById('loginPasswordInput');
                if (loginPasswordInput) {
                    loginPasswordInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            processLoginFromModal();
                        }
                    });
                }
                
                // Cerrar modal al hacer click fuera de √©l
                if (modal) {
                    modal.addEventListener('click', function(e) {
                        if (e.target === modal) {
                            hideEmailModal();
                        }
                    });
                }
                
                console.log('‚úÖ Bot√≥n y modal configurados correctamente');
            }
            
            // Ejecutar cuando el DOM est√© listo
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', setupButtonAndModal);
            } else {
                setupButtonAndModal();
            }
            
            // Tambi√©n ejecutar despu√©s de un peque√±o delay por si acaso
            setTimeout(setupButtonAndModal, 50);
        })();

        // Funci√≥n para alternar visibilidad de contrase√±a
        function togglePassword(inputId, button) {
            var input = document.getElementById(inputId);
            if (input) {
                if (input.type === 'password') {
                    input.type = 'text';
                    button.textContent = 'üôà';
                    button.setAttribute('aria-label', 'Ocultar contrase√±a');
                } else {
                    input.type = 'password';
                    button.textContent = 'üëÅÔ∏è';
                    button.setAttribute('aria-label', 'Mostrar contrase√±a');
                }
            }
        }

        // Prevenir navegaci√≥n con las flechas del navegador (back/forward) - BLOQUEO COMPLETO
        (function() {
            var bloqueado = false;
            var urlInicio = window.location.href;
            
            // Funci√≥n para bloquear navegaci√≥n
            function bloquearNavegacion() {
                if (bloqueado) return;
                
                // Reemplazar la entrada actual del historial
                history.replaceState({page: 'inicio'}, null, urlInicio);
                
                // Agregar m√∫ltiples entradas al historial para bloquear ambas direcciones
                history.pushState({page: 'inicio'}, null, urlInicio);
                history.pushState({page: 'inicio'}, null, urlInicio);
                history.pushState({page: 'inicio'}, null, urlInicio);
            }
            
            // Bloquear inmediatamente al cargar
            bloquearNavegacion();
            bloqueado = true;
            
            // Bloquear cuando el documento est√© listo
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    bloquearNavegacion();
                    bloqueado = true;
                });
            } else {
                bloquearNavegacion();
                bloqueado = true;
            }
            
            // Bloquear despu√©s de delays para asegurar que se ejecute
            setTimeout(function() {
                bloquearNavegacion();
                bloqueado = true;
            }, 50);
            setTimeout(function() {
                bloquearNavegacion();
                bloqueado = true;
            }, 100);
            setTimeout(function() {
                bloquearNavegacion();
                bloqueado = true;
            }, 500);
            
            // Prevenir navegaci√≥n cuando el usuario intenta usar las flechas del navegador
            window.addEventListener('popstate', function(event) {
                // Volver a agregar entradas al historial inmediatamente ANTES de cualquier otra acci√≥n
                history.pushState({page: 'inicio'}, null, urlInicio);
                history.pushState({page: 'inicio'}, null, urlInicio);
                history.pushState({page: 'inicio'}, null, urlInicio);
                
                // Forzar que la p√°gina permanezca en inicio.html
                if (window.location.pathname.indexOf('inicio.html') === -1) {
                    window.location.replace(urlInicio);
                }
                
                // Prevenir cualquier acci√≥n adicional
                event.stopImmediatePropagation();
                
                return false;
            }, true); // Usar capture phase para interceptar ANTES que otros listeners
            
            // Interceptar cualquier cambio en la URL como respaldo adicional
            var lastUrl = window.location.href;
            setInterval(function() {
                var currentUrl = window.location.href;
                if (currentUrl !== lastUrl && currentUrl !== urlInicio && window.location.pathname.indexOf('inicio.html') === -1) {
                    window.location.replace(urlInicio);
                }
                lastUrl = window.location.href;
            }, 50);
            
            // Bloquear tambi√©n el evento hashchange
            window.addEventListener('hashchange', function(event) {
                event.preventDefault();
                event.stopImmediatePropagation();
                window.location.replace(urlInicio);
                return false;
            }, true);
        })();

        // Limpiar sesi√≥n peri√≥dicamente mientras estamos en inicio.html
        // Esto asegura que incluso si auth.js intenta guardar una sesi√≥n, se limpie
        (function() {
            function limpiarSesionEnInicio() {
                try {
                    sessionStorage.removeItem('current_session');
                    localStorage.removeItem('current_session');
                    console.log('üßπ Sesi√≥n limpiada en inicio.html');
                } catch (error) {
                    console.error('‚ùå Error al limpiar sesi√≥n:', error);
                }
            }
            
            // Limpiar inmediatamente
            limpiarSesionEnInicio();
            
            // Limpiar cuando el documento est√© completamente cargado
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', limpiarSesionEnInicio);
            } else {
                limpiarSesionEnInicio();
            }
            
            // Limpiar despu√©s de m√∫ltiples delays para asegurar que se ejecute despu√©s de auth.js
            setTimeout(limpiarSesionEnInicio, 100);
            setTimeout(limpiarSesionEnInicio, 500);
            setTimeout(limpiarSesionEnInicio, 1000);
            setTimeout(limpiarSesionEnInicio, 2000);
            setTimeout(limpiarSesionEnInicio, 3000);
            
            // Limpiar cuando la ventana recibe foco (por si el usuario vuelve a la pesta√±a)
            window.addEventListener('focus', limpiarSesionEnInicio);
            
            // Interceptar cualquier intento de guardar sesi√≥n mientras estamos en inicio.html
            // PERO permitir guardar cuando el usuario inicia sesi√≥n exitosamente desde el modal
            var originalSetSession = null;
            var permitirGuardarSesion = false; // Flag para permitir guardar sesi√≥n cuando el usuario inicia sesi√≥n
            
            var checkInterval = setInterval(function() {
                if (window.authSystem && window.authSystem.setSession) {
                    if (!originalSetSession) {
                        originalSetSession = window.authSystem.setSession;
                        window.authSystem.setSession = function(user) {
                            // Solo permitir guardar sesi√≥n si el flag est√° activado (usuario inici√≥ sesi√≥n)
                            if (permitirGuardarSesion) {
                                console.log('‚úÖ Guardando sesi√≥n despu√©s de login exitoso');
                                return originalSetSession.call(this, user);
                            } else {
                                console.log('‚ö†Ô∏è Intento de guardar sesi√≥n en inicio.html bloqueado');
                                // No guardar la sesi√≥n mientras estamos en inicio.html
                                return;
                            }
                        };
                        console.log('üîí Interceptor de setSession activado en inicio.html');
                    }
                }
            }, 100);
            
            // Permitir guardar sesi√≥n cuando el usuario inicia sesi√≥n desde el modal
            // Esto se activar√° en processLoginFromModal ANTES de llamar a login()
            window.permitirGuardarSesionEnInicio = function() {
                permitirGuardarSesion = true;
                console.log('‚úÖ Permiso para guardar sesi√≥n activado');
            };
            
            // Funci√≥n para resetear el permiso (se llama cuando se muestra el modal de nuevo)
            window.resetPermisoGuardarSesion = function() {
                permitirGuardarSesion = false;
                console.log('üîÑ Permiso para guardar sesi√≥n reseteado');
            };
            
            // Limpiar el intervalo despu√©s de 10 segundos
            setTimeout(function() {
                clearInterval(checkInterval);
            }, 10000);
        })();
    </script>
    
    <!-- PWA Service Worker Registration -->
    <script src="../assets/js/pwa-register.js"></script>

</body>

</html>
