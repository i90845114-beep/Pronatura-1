<!DOCTYPE html>

<html lang="es">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

    <title>Inicio - Organic Journal</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#4D8143">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ProNatura">
    <meta name="description" content="Sistema de registro ambiental y control social para la conservaci√≥n de la biodiversidad">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="../manifest.json" id="manifestLink">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="../assets/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="72x72" href="../assets/icons/icon-72x72.png">
    <link rel="apple-touch-icon" sizes="96x96" href="../assets/icons/icon-96x96.png">
    <link rel="apple-touch-icon" sizes="128x128" href="../assets/icons/icon-128x128.png">
    <link rel="apple-touch-icon" sizes="152x152" href="../assets/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="192x192" href="../assets/icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="384x384" href="../assets/icons/icon-384x384.png">
    <link rel="apple-touch-icon" sizes="512x512" href="../assets/icons/icon-512x512.png">
    
    <link rel="icon" type="image/jpeg" href="../assets/logo.jpg">
    <link rel="stylesheet" href="../assets/css/styles.css" id="cssLink">
    <script>
        // LIMPIAR SESI√ìN INMEDIATAMENTE - Esto debe ejecutarse ANTES de cualquier otro c√≥digo
        // para asegurar que inicio.html siempre aparezca sin sesi√≥n guardada
        (function() {
            try {
                sessionStorage.removeItem('current_session');
                localStorage.removeItem('current_session');
                sessionStorage.removeItem('index_acceso_permitido'); // Limpiar flag de acceso permitido

            } catch (error) {

            }
        })();

        // Corregir ruta del CSS, logo y manifest para Hostinger
        (function() {
            var currentUrl = window.location.href.toLowerCase();
            var cssLink = document.getElementById('cssLink');
            var manifestLink = document.getElementById('manifestLink');
            var isHostinger = currentUrl.indexOf('hostinger') !== -1 || 
                             currentUrl.indexOf('hostingersite.com') !== -1 ||
                             currentUrl.indexOf('organicjournal.com.mx') !== -1;
            
            if (cssLink && isHostinger) {
                cssLink.href = '/assets/css/styles.css';
            }
            
            if (manifestLink && isHostinger) {
                manifestLink.href = '/manifest.json';
            }
            
            // Ajustar rutas de logo despu√©s de que el DOM est√© listo
            function adjustLogoSources() {
                var bannerLogo = document.querySelector('.banner-logo');
                var headerLogo = document.querySelector('.logo-header');
                var logoSrc = isHostinger ? '/assets/logo.jpg' : '../assets/logo.jpg';
                if (bannerLogo && bannerLogo.dataset.hostingerSrc) {
                    bannerLogo.src = isHostinger ? bannerLogo.dataset.hostingerSrc : bannerLogo.dataset.localSrc;
                }
                if (headerLogo && headerLogo.dataset.hostingerSrc) {
                    headerLogo.src = isHostinger ? headerLogo.dataset.hostingerSrc : headerLogo.dataset.localSrc;
                }
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', adjustLogoSources);
            } else {
                adjustLogoSources();
            }
            
            // Tambi√©n ejecutar despu√©s de un peque√±o delay por si acaso
            setTimeout(adjustLogoSources, 100);
        })();
    </script>

    <style>

        .landing-page {

            min-height: 100vh;

            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 25%, #b2dfdb 50%, #a5d6a7 75%, #81c784 100%);

            color: #333;

            display: flex;

            flex-direction: column;

            align-items: center;

            justify-content: center;

            padding: 2rem;

            text-align: center;

        }

        .landing-title {

            font-size: 3rem;

            margin-bottom: 1rem;

            font-weight: 700;

            display: flex;

            align-items: center;

            justify-content: center;

            gap: 1rem;

            flex-wrap: wrap;

            background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 50%, #4caf50 100%);

            -webkit-background-clip: text;

            -webkit-text-fill-color: transparent;

            background-clip: text;

        }

        .logo-header {

            height: 80px;

            width: auto;

            object-fit: contain;

            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));

            display: block;

            flex-shrink: 0;

        }

        .top-banner {

            background: linear-gradient(135deg, #2e7d32 0%, #388e3c 50%, #43a047 100%);

            color: white;

            padding: 1rem 2rem;

            display: flex;

            align-items: center;

            justify-content: space-between;

            width: 100%;

            border-radius: 0 0 12px 12px;

            box-shadow: 0 4px 20px rgba(46, 125, 50, 0.4);

            margin-bottom: 2rem;

        }

        .banner-content {

            display: flex;

            align-items: center;

            gap: 1rem;

            flex: 1;

        }

        .banner-logo {

            height: 50px;

            width: auto;

            object-fit: contain;

            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));

        }

        .banner-text {

            font-size: 1.2rem;

            font-weight: 600;

            white-space: nowrap;

            overflow: hidden;

            text-overflow: ellipsis;

            color: white;

            text-shadow: 0 2px 4px rgba(0,0,0,0.2);

        }

        .banner-close {

            background: rgba(255, 255, 255, 0.2);

            border: none;

            color: white;

            font-size: 1.5rem;

            cursor: pointer;

            padding: 0.5rem;

            border-radius: 50%;

            width: 35px;

            height: 35px;

            display: flex;

            align-items: center;

            justify-content: center;

            transition: all 0.3s;

        }

        .banner-close:hover {

            background: rgba(255, 255, 255, 0.3);

            color: white;

            transform: scale(1.1);

        }

        .landing-subtitle {

            font-size: 1.5rem;

            margin-bottom: 2rem;

            color: #2e7d32;

            font-weight: 600;

            letter-spacing: 0.5px;

        }

        .landing-description {

            font-size: 1.2rem;

            margin-bottom: 3rem;

            color: #424242;

            max-width: 800px;

            line-height: 1.9;

            padding: 1.5rem 2rem;

            background: linear-gradient(135deg, #ffffff 0%, #f1f8e9 100%);

            border-radius: 12px;

            border-left: 4px solid #4caf50;

            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.2);

        }

        .landing-description strong {

            color: #2e7d32;

            font-weight: 700;

        }

        .what-is-section {

            background: linear-gradient(135deg, #ffffff 0%, #e8f5e9 100%);

            border-left: 5px solid #66bb6a;

            padding: 2.5rem;

            border-radius: 12px;

            margin-bottom: 3rem;

            max-width: 900px;

            width: 100%;

            box-shadow: 0 4px 20px rgba(102, 187, 106, 0.25);

            transition: transform 0.3s ease, box-shadow 0.3s ease;

        }

        .what-is-section:hover {

            transform: translateY(-2px);

            box-shadow: 0 6px 25px rgba(102, 187, 106, 0.35);

        }

        .what-is-section h2 {

            font-size: 2rem;

            margin-bottom: 1.5rem;

            background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%);

            -webkit-background-clip: text;

            -webkit-text-fill-color: transparent;

            background-clip: text;

            font-weight: 700;

        }

        .what-is-section p {

            font-size: 1.1rem;

            line-height: 1.9;

            color: #424242;

        }

        .how-it-works {

            background: linear-gradient(135deg, #ffffff 0%, #f1f8e9 100%);

            color: #333;

            padding: 4rem 2rem;

            width: 100%;

            max-width: 1200px;

            border-radius: 16px;

            margin-bottom: 3rem;

            border: 2px solid #81c784;

            box-shadow: 0 4px 20px rgba(129, 199, 132, 0.2);

        }

        .how-it-works h2 {

            font-size: 2.5rem;

            margin-bottom: 3rem;

            font-weight: 700;

            background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 50%, #4caf50 100%);

            -webkit-background-clip: text;

            -webkit-text-fill-color: transparent;

            background-clip: text;

        }

        .steps-container {

            display: grid;

            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));

            gap: 3rem;

            margin-bottom: 3rem;

        }

        .step {

            display: flex;

            flex-direction: column;

            align-items: center;

            text-align: center;

            padding: 1.5rem;

            border-radius: 16px;

            transition: all 0.3s ease;

        }

        .step:hover {

            background: rgba(0,0,0,0.02);

            transform: translateY(-5px);

        }

        .step-number {

            width: 80px;

            height: 80px;

            border-radius: 50%;

            display: flex;

            align-items: center;

            justify-content: center;

            font-size: 2.5rem;

            font-weight: 700;

            margin-bottom: 1.5rem;

            color: white;

            transition: transform 0.3s ease, box-shadow 0.3s ease;

        }

        .step:hover .step-number {

            transform: scale(1.1) rotate(5deg);

        }

        .step-icon {

            font-size: 3rem;

            margin-bottom: 1rem;

            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));

        }

        .step:nth-child(1) .step-number {
            background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .step:nth-child(1):hover .step-number {
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.5);
        }

        .step:nth-child(1) h3 {
            color: #2e7d32;
        }

        .step:nth-child(2) .step-number {
            background: linear-gradient(135deg, #26a69a 0%, #00897b 100%);
            box-shadow: 0 6px 20px rgba(38, 166, 154, 0.4);
        }

        .step:nth-child(2):hover .step-number {
            box-shadow: 0 8px 25px rgba(38, 166, 154, 0.5);
        }

        .step:nth-child(2) h3 {
            color: #00897b;
        }

        .step:nth-child(3) .step-number {
            background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%);
            box-shadow: 0 6px 20px rgba(102, 187, 106, 0.4);
        }

        .step:nth-child(3):hover .step-number {
            box-shadow: 0 8px 25px rgba(102, 187, 106, 0.5);
        }

        .step:nth-child(3) h3 {
            color: #388e3c;
        }

        .step h3 {

            font-size: 1.5rem;

            margin-bottom: 1rem;

            font-weight: 700;

        }

        .step p {

            font-size: 1.1rem;

            color: #616161;

            line-height: 1.8;

        }

        .cta-section {

            margin-top: 3rem;

            padding: 2rem;

            background: linear-gradient(135deg, #ffffff 0%, #e8f5e9 100%);

            border-radius: 16px;

            border: 2px solid #66bb6a;

            box-shadow: 0 4px 20px rgba(102, 187, 106, 0.3);

        }

        .cta-question {

            font-size: 1.8rem;

            margin-bottom: 2rem;

            background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 100%);

            -webkit-background-clip: text;

            -webkit-text-fill-color: transparent;

            background-clip: text;

            font-weight: 700;

        }

        .cta-button {

            padding: 1rem 3rem;

            background: linear-gradient(135deg, #2e7d32 0%, #4caf50 50%, #66bb6a 100%);

            color: white;

            border: none;

            border-radius: 30px;

            font-size: 1.2rem;

            font-weight: 700;

            cursor: pointer;

            transition: all 0.3s ease;

            text-decoration: none;

            display: inline-block;

            position: relative;

            z-index: 10;

            pointer-events: auto;

            box-shadow: 0 4px 20px rgba(46, 125, 50, 0.4);

            letter-spacing: 0.5px;

        }

        .cta-button:hover {

            background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 100%);

            transform: translateY(-4px);

            box-shadow: 0 8px 30px rgba(27, 94, 32, 0.5);

        }

        .admin-link {
            margin-top: 2rem;
            text-align: center;
        }

        .admin-link a {
            color: #616161;
            text-decoration: none;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            padding: 0.6rem 1.2rem;
            border-radius: 25px;
            background: linear-gradient(135deg, #ffffff 0%, #f1f8e9 100%);
            border: 1px solid #81c784;
        }

        .admin-link a:hover {
            color: white;
            background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%);
            border-color: #4caf50;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        /* Estilos para el modal de verificaci√≥n de email */
        .email-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }

        .email-modal.show {
            display: flex;
        }

        .email-modal-content {
            background: white;
            border-radius: 12px;
            padding: 2.5rem;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            text-align: center;
        }

        .email-modal-content h2 {
            color: #4D8143;
            margin-bottom: 1rem;
            font-size: 1.8rem;
        }

        .email-modal-content p {
            color: #666;
            margin-bottom: 1.5rem;
        }

        .email-modal-content input {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 1rem;
            box-sizing: border-box;
        }

        .email-modal-content input:focus {
            outline: none;
            border-color: #4D8143;
        }

        .email-modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .email-modal-buttons button {
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .email-modal-buttons .btn-primary {
            background: #4D8143;
            color: white;
        }

        .email-modal-buttons .btn-primary:hover {
            background: #3d6a35;
        }

        .email-modal-buttons .btn-primary:disabled {
            background: #9e9e9e;
            cursor: not-allowed;
        }

        .email-modal-buttons .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .email-modal-buttons .btn-secondary:hover {
            background: #d0d0d0;
        }

        .email-modal .error-message {
            background: #fee;
            color: #c33;
            padding: 0.8rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }

        .email-modal .error-message.show {
            display: block;
        }

        .email-modal .loading {
            display: none;
            color: #4D8143;
            margin-top: 1rem;
            font-weight: 600;
        }

        .email-modal .loading.show {
            display: block;
        }

        .email-modal-content input[readonly] {
            background-color: white;
            cursor: not-allowed;
        }

        #loginView input {
            margin-bottom: 1rem;
        }

        /* Estilos para ver/ocultar contrase√±a */
        .password-wrapper {
            position: relative;
            width: 100%;
        }

        .password-wrapper input {
            padding-right: 45px;
            width: 100%;
            box-sizing: border-box;
        }

        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            color: #666;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.3s;
        }

        .password-toggle:hover {
            color: #4D8143;
        }

        .password-toggle:focus {
            outline: none;
        }

        /* Responsive para m√≥viles */
        @media (max-width: 768px) {
            .landing-page {
                padding: 1rem;
            }

            .landing-title {
                font-size: 1.8rem;
                margin-bottom: 0.5rem;
                gap: 0.8rem;
            }

            .logo-header {
                height: 60px;
            }

            .top-banner {
                padding: 0.8rem 1rem;
                margin-bottom: 1.5rem;
            }

            .banner-logo {
                height: 40px;
            }

            .banner-text {
                font-size: 1rem;
            }

            .banner-close {
                width: 30px;
                height: 30px;
                font-size: 1.3rem;
            }

            .landing-subtitle {
                font-size: 1.1rem;
                margin-bottom: 1rem;
            }

            .landing-description {
                font-size: 1rem;
                margin-bottom: 2rem;
                padding: 0 0.5rem;
            }

            .what-is-section {
                padding: 1.5rem;
                margin-bottom: 2rem;
            }

            .what-is-section h2 {
                font-size: 1.5rem;
                margin-bottom: 1rem;
            }

            .what-is-section p {
                font-size: 1rem;
            }

            .step-icon {
                font-size: 2.5rem;
            }

            .step-number {
                width: 60px;
                height: 60px;
                font-size: 2rem;
            }

            .how-it-works {
                padding: 2rem 1rem;
                margin-bottom: 2rem;
            }

            .how-it-works h2 {
                font-size: 1.8rem;
                margin-bottom: 2rem;
            }

            .steps-container {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .step h3 {
                font-size: 1.2rem;
            }

            .step p {
                font-size: 1rem;
            }

            .cta-question {
                font-size: 1.3rem;
                margin-bottom: 1.5rem;
            }

            .cta-button {
                padding: 0.9rem 2rem;
                font-size: 1rem;
                width: 100%;
                max-width: 300px;
            }

            .email-modal-content {
                padding: 1.5rem;
                max-width: 95%;
                width: 95%;
            }

            .email-modal-content h2 {
                font-size: 1.5rem;
            }

            .email-modal-content input {
                font-size: 16px; /* Previene zoom en iOS */
            }

            .email-modal-buttons {
                flex-direction: column;
            }

            .email-modal-buttons button {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .landing-title {
                font-size: 1.5rem;
                gap: 0.5rem;
            }

            .logo-header {
                height: 50px;
            }

            .top-banner {
                padding: 0.6rem 0.8rem;
                margin-bottom: 1rem;
            }

            .banner-logo {
                height: 35px;
            }

            .banner-text {
                font-size: 0.9rem;
            }

            .banner-close {
                width: 28px;
                height: 28px;
                font-size: 1.2rem;
            }

            .landing-subtitle {
                font-size: 1rem;
            }

            .landing-description {
                font-size: 0.9rem;
            }

            .what-is-section {
                padding: 1rem;
            }

            .what-is-section h2 {
                font-size: 1.3rem;
            }

            .what-is-section p {
                font-size: 0.9rem;
            }

            .step-icon {
                font-size: 2rem;
            }

            .how-it-works {
                padding: 1.5rem 0.8rem;
            }

            .how-it-works h2 {
                font-size: 1.5rem;
            }

            .step-number {
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
            }

            .cta-button {
                padding: 0.8rem 1.5rem;
                font-size: 0.95rem;
            }
        }

    </style>

</head>

<body>

    <div class="landing-page">

        <h1 class="landing-title">
            <img src="../assets/logo.jpg" alt="Logo ProNatura" class="logo-header" data-local-src="../assets/logo.jpg" data-hostinger-src="/assets/logo.jpg">
            <span>Protege la Fauna Silvestre de Tamaulipas</span>
        </h1>

        <p class="landing-subtitle">Sistema de Reporte y Monitoreo Ambiental</p>

        <p class="landing-description">
            ¬øViste un animal silvestre en peligro? ¬øObservaste una actividad que afecta el medio ambiente? 
            <strong>Reporta lo que ves</strong> y ayuda a proteger la biodiversidad de nuestro estado. 
            Tu participaci√≥n es esencial para conservar nuestra riqueza natural.
        </p>

        <div class="what-is-section">
            <h2>¬øQu√© es esta plataforma?</h2>
            <p>
                Es una herramienta digital que permite a cualquier ciudadano reportar avistamientos de fauna silvestre, 
                actividades que afectan el medio ambiente o situaciones que requieren atenci√≥n. Tus reportes ayudan a 
                las autoridades y organizaciones a tomar acciones para proteger y conservar la biodiversidad de Tamaulipas.
            </p>
        </div>

        <div class="how-it-works">

            <h2>C√≥mo Funciona</h2>

            <div class="steps-container">

                <div class="step">

                    <div class="step-icon">üìù</div>

                    <div class="step-number">1</div>

                    <h3>Registra lo que observaste</h3>

                    <p>Describe lo que viste: tipo de animal, situaci√≥n, fecha y cualquier detalle importante. 
                    Puedes incluir fotos para que el reporte sea m√°s completo.</p>

                </div>

                <div class="step">

                    <div class="step-icon">üìç</div>

                    <div class="step-number">2</div>

                    <h3>Marca la ubicaci√≥n en el mapa</h3>

                    <p>Indica exactamente d√≥nde ocurri√≥ el avistamiento o la situaci√≥n. 
                    Esto ayuda a las autoridades a ubicar y atender el caso r√°pidamente.</p>

                </div>

                <div class="step">

                    <div class="step-icon">üìä</div>

                    <div class="step-number">3</div>

                    <h3>Consulta y da seguimiento</h3>

                    <p>Revisa todos tus reportes anteriores, su estado y las acciones tomadas. 
                    Tu participaci√≥n activa ayuda a construir un mejor monitoreo ambiental.</p>

                </div>

            </div>

        </div>

        <div class="cta-section">

            <p class="cta-question">¬øListo para ayudar a proteger nuestra biodiversidad?</p>

            <button type="button" class="cta-button" id="loginButton">Comenzar a Reportar</button>
            
            <a href="chat.html" id="chatButton" class="cta-button" style="text-decoration: none; display: inline-block; margin-top: 1rem; background: linear-gradient(135deg, #00897b 0%, #26a69a 50%, #4db6ac 100%); box-shadow: 0 4px 20px rgba(0, 137, 123, 0.4);">
                üí¨ Acceder al Chat de Ejidos
            </a>
            <!-- Modal: ¬øAcceder a chats o nueva solicitud? -->
            <div id="chatChoiceModal" class="email-modal" style="display: none;">
                <div class="email-modal-content chat-choice-content" style="background: rgba(255,255,255,0.7); backdrop-filter: blur(14px); -webkit-backdrop-filter: blur(14px); border-radius: 16px; padding: 2rem 2.25rem; max-width: 420px; width: 90%; box-shadow: 0 25px 50px rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.8);">
                    <h2>üí¨ Chat de Ejidos</h2>
                    <p style="margin: 1rem 0;">¬øQu√© deseas hacer?</p>
                    <div style="display: flex; flex-direction: column; gap: 0.75rem; margin-top: 1.25rem;">
                        <button type="button" id="btnAccederChats" class="btn-primary" style="width: 100%; padding: 0.9rem;">Acceder a mis chats</button>
                        <button type="button" id="btnNuevaSolicitud" class="btn-secondary" style="width: 100%; padding: 0.9rem;">Enviar nueva solicitud</button>
                        <button type="button" id="btnCancelarChatChoice" class="btn-secondary" style="width: 100%; padding: 0.6rem; background: #e0e0e0;">Cancelar</button>
                    </div>
                </div>
            </div>

            <div class="admin-link" style="display: flex; gap: 1rem; justify-content: center; align-items: center; flex-wrap: wrap; margin-top: 1rem;">
                <a href="admin-login.html">
                    <span>‚öôÔ∏è</span>
                    <span>Acceso Administrador</span>
                </a>
            </div>

    </div>

    <!-- Modal de verificaci√≥n de email -->
    <div id="emailModal" class="email-modal">
        <div class="email-modal-content">
            <!-- Vista de verificaci√≥n de email -->
            <div id="emailVerificationView">
                <h2>¬øYa tienes cuenta?</h2>
                <p>Ingresa tu correo electr√≥nico para continuar</p>
                <div id="emailModalError" class="error-message"></div>
                <div id="emailModalLoading" class="loading">Verificando...</div>
                <input type="email" id="emailInput" placeholder="correo@ejemplo.com" autocomplete="email">
                <div class="email-modal-buttons">
                    <button type="button" class="btn-primary" id="verifyEmailBtn">Continuar</button>
                    <button type="button" class="btn-secondary" id="cancelEmailBtn">Cancelar</button>
                </div>
            </div>
            
            <!-- Vista de inicio de sesi√≥n (se muestra cuando el email existe) -->
            <div id="loginView" style="display: none;">
                <h2>Iniciar Sesi√≥n</h2>
                <p>Ingresa tu contrase√±a para continuar</p>
                <div id="loginModalError" class="error-message"></div>
                <div id="loginModalLoading" class="loading">Iniciando sesi√≥n...</div>
                <input type="email" id="loginEmailInput" readonly style="background-color: white; cursor: not-allowed;">
                <div class="password-wrapper">
                    <input type="password" id="loginPasswordInput" placeholder="Contrase√±a" autocomplete="current-password">
                    <button type="button" class="password-toggle" onclick="togglePassword('loginPasswordInput', this)" aria-label="Mostrar contrase√±a">
                        üëÅÔ∏è
                    </button>
                </div>
                <div style="margin-bottom: 1rem; text-align: center;">
                    <a href="recuperar-contrase√±a.html" style="color: #666; font-size: 0.9rem; text-decoration: none;">¬øOlvidaste tu contrase√±a?</a>
                </div>
                <div class="email-modal-buttons">
                    <button type="button" class="btn-primary" id="loginSubmitBtn">Iniciar Sesi√≥n</button>
                    <button type="button" class="btn-secondary" id="backToEmailBtn">Volver</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Limpiar sesi√≥n INMEDIATAMENTE al cargar inicio.html para que siempre aparezca sin sesi√≥n guardada
        // Esto debe ejecutarse ANTES de cualquier otro script
        (function() {
            try {
                sessionStorage.removeItem('current_session');
                localStorage.removeItem('current_session'); // Limpiar tambi√©n localStorage por compatibilidad

            } catch (error) {

            }
        })();

        // Cargar auth.js con detecci√≥n de entorno
        (function() {
            var currentUrl = window.location.href.toLowerCase();
            var isHostinger = currentUrl.indexOf('hostinger') !== -1 || 
                             currentUrl.indexOf('hostingersite.com') !== -1 ||
                             currentUrl.indexOf('organicjournal.com.mx') !== -1;
            
            var script = document.createElement('script');
            script.id = 'authScript';
            
            if (isHostinger) {
                // Usar ruta absoluta desde la ra√≠z del dominio
                script.src = '/assets/js/auth.js?v=' + Date.now();
            } else {
                script.src = '../assets/js/auth.js';
            }
            
            script.onerror = function() {

            };
            
            script.onload = function() {

                // Limpiar sesi√≥n nuevamente despu√©s de cargar auth.js para asegurar que no haya sesi√≥n guardada
                try {
                    sessionStorage.removeItem('current_session');
                    localStorage.removeItem('current_session');

                } catch (error) {

                }
                
                if (window.authSystem) {
                    if (typeof window.authSystem.checkEmail === 'function') {

                    } else {

                    }
                } else {

                }
            };
            
            document.head.appendChild(script);
        })();
    </script>

    <script>
        // Modal: ¬øAcceder a chats o enviar nueva solicitud?
        (function() {
            function initChatChoiceModal() {
                var chatBtn = document.getElementById('chatButton');
                var modal = document.getElementById('chatChoiceModal');
                var btnChats = document.getElementById('btnAccederChats');
                var btnSolicitud = document.getElementById('btnNuevaSolicitud');
                var btnCancelar = document.getElementById('btnCancelarChatChoice');
                if (!chatBtn || !modal) return;

                function openModal(e) {
                    e.preventDefault();
                    modal.style.display = 'flex';
                    if (modal.classList) modal.classList.add('show');
                }
                function closeModal() {
                    modal.style.display = 'none';
                    if (modal.classList) modal.classList.remove('show');
                }
                function goToChat() {
                    closeModal();
                    window.location.href = 'chat.html';
                }
                function goToGrupos() {
                    closeModal();
                    window.location.href = 'grupos.html';
                }

                chatBtn.addEventListener('click', openModal);
                if (btnChats) btnChats.addEventListener('click', goToChat);
                if (btnSolicitud) btnSolicitud.addEventListener('click', goToGrupos);
                if (btnCancelar) btnCancelar.addEventListener('click', closeModal);
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) closeModal();
                });
            }
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initChatChoiceModal);
            } else {
                initChatChoiceModal();
            }
        })();
    </script>

    <script>
        // DETECCI√ìN DE ENTORNO Y NAVEGACI√ìN CON VERIFICACI√ìN DE EMAIL
        (function() {
            'use strict';
            
            // Funci√≥n para detectar si estamos en Hostinger
            function isHostinger() {
                var currentUrl = window.location.href.toLowerCase();
                return currentUrl.indexOf('hostinger') !== -1 || 
                       currentUrl.indexOf('hostingersite.com') !== -1 ||
                       currentUrl.indexOf('organicjournal.com.mx') !== -1;
            }
            
            // Funci√≥n para obtener la ruta correcta de login
            function getLoginPath() {
                var currentPath = window.location.pathname;
                var isInPages = currentPath.indexOf('/pages/') !== -1;
                
                if (isHostinger()) {
                    return 'login.html';
                } else {
                    if (isInPages) {
                        return 'login.html';
                    } else {
                        return 'pages/login.html';
                    }
                }
            }
            
            // Funci√≥n para obtener la ruta correcta de registro
            function getRegistroPath() {
                var currentPath = window.location.pathname;
                var isInPages = currentPath.indexOf('/pages/') !== -1;
                
                if (isHostinger()) {
                    return 'registro.html';
                } else {
                    if (isInPages) {
                        return 'registro.html';
                    } else {
                        return 'pages/registro.html';
                    }
                }
            }

            // Funci√≥n para navegar al login con email prellenado
            function navigateToLogin(email) {
                try {

                    sessionStorage.setItem('allowLoginAccess', 'true');
                    if (email) {
                        sessionStorage.setItem('prefillEmail', email);
                    }
                    var loginPath = getLoginPath();
                    window.location.href = loginPath;
                } catch (error) {

                    window.location.href = getLoginPath();
                }
            }
            
            // Funci√≥n para navegar al registro con email prellenado
            function navigateToRegistro(email) {
                try {

                    if (email) {
                        sessionStorage.setItem('prefillEmail', email);
                    }
                    var registroPath = getRegistroPath();
                    window.location.href = registroPath;
                } catch (error) {

                    window.location.href = getRegistroPath();
                }
            }
            
            // Funci√≥n para mostrar el modal de verificaci√≥n
            function showEmailModal() {
                var modal = document.getElementById('emailModal');
                var emailInput = document.getElementById('emailInput');
                var errorDiv = document.getElementById('emailModalError');
                var loadingDiv = document.getElementById('emailModalLoading');
                var emailVerificationView = document.getElementById('emailVerificationView');
                var loginView = document.getElementById('loginView');
                var loginErrorDiv = document.getElementById('loginModalError');
                var loginLoadingDiv = document.getElementById('loginModalLoading');
                var loginSubmitBtn = document.getElementById('loginSubmitBtn');
                var loginPasswordInput = document.getElementById('loginPasswordInput');
                
                // Resetear el flag de permiso cuando se muestra el modal
                if (window.resetPermisoGuardarSesion) {
                    window.resetPermisoGuardarSesion();
                }
                
                if (modal) {
                    modal.classList.add('show');
                    errorDiv.classList.remove('show');
                    loadingDiv.classList.remove('show');
                    emailInput.value = '';
                    emailInput.focus();
                    
                    // Limpiar estado del login
                    if (loginErrorDiv) {
                        loginErrorDiv.textContent = '';
                        loginErrorDiv.classList.remove('show');
                    }
                    if (loginLoadingDiv) loginLoadingDiv.classList.remove('show');
                    if (loginSubmitBtn) {
                        loginSubmitBtn.disabled = false;
                        loginSubmitBtn.textContent = 'Iniciar Sesi√≥n';
                    }
                    if (loginPasswordInput) {
                        loginPasswordInput.value = '';
                    }
                    
                    // Mostrar vista de verificaci√≥n y ocultar vista de login
                    if (emailVerificationView) emailVerificationView.style.display = 'block';
                    if (loginView) loginView.style.display = 'none';
                }
            }
            
            // Funci√≥n para ocultar el modal
            function hideEmailModal() {
                var modal = document.getElementById('emailModal');
                var errorDiv = document.getElementById('emailModalError');
                var loadingDiv = document.getElementById('emailModalLoading');
                var loginErrorDiv = document.getElementById('loginModalError');
                var loginLoadingDiv = document.getElementById('loginModalLoading');
                var emailVerificationView = document.getElementById('emailVerificationView');
                var loginView = document.getElementById('loginView');
                var loginSubmitBtn = document.getElementById('loginSubmitBtn');
                var loginPasswordInput = document.getElementById('loginPasswordInput');
                var emailInput = document.getElementById('emailInput');
                
                if (modal) {
                    modal.classList.remove('show');
                    errorDiv.classList.remove('show');
                    loadingDiv.classList.remove('show');
                    
                    // Limpiar estado del login
                    if (loginErrorDiv) {
                        loginErrorDiv.textContent = '';
                        loginErrorDiv.classList.remove('show');
                    }
                    if (loginLoadingDiv) loginLoadingDiv.classList.remove('show');
                    if (loginSubmitBtn) {
                        loginSubmitBtn.disabled = false;
                        loginSubmitBtn.textContent = 'Iniciar Sesi√≥n';
                    }
                    if (loginPasswordInput) {
                        loginPasswordInput.value = '';
                    }
                    if (emailInput) {
                        emailInput.value = '';
                    }
                    
                    // Resetear vistas
                    if (emailVerificationView) emailVerificationView.style.display = 'block';
                    if (loginView) loginView.style.display = 'none';
                }
            }
            
            // Funci√≥n para mostrar la vista de login
            function showLoginView(email) {
                var emailVerificationView = document.getElementById('emailVerificationView');
                var loginView = document.getElementById('loginView');
                var loginEmailInput = document.getElementById('loginEmailInput');
                var loginPasswordInput = document.getElementById('loginPasswordInput');
                var loginErrorDiv = document.getElementById('loginModalError');
                var loginLoadingDiv = document.getElementById('loginModalLoading');
                var loginSubmitBtn = document.getElementById('loginSubmitBtn');
                
                // Resetear el flag de permiso cuando se muestra el modal de nuevo
                // Esto asegura que cada intento de login tenga que activar el permiso nuevamente
                if (window.resetPermisoGuardarSesion) {
                    window.resetPermisoGuardarSesion();
                }
                
                if (emailVerificationView) emailVerificationView.style.display = 'none';
                if (loginView) loginView.style.display = 'block';
                if (loginEmailInput) loginEmailInput.value = email;
                if (loginPasswordInput) {
                    loginPasswordInput.value = '';
                    loginPasswordInput.focus();
                }
                // Limpiar errores y estado del bot√≥n
                if (loginErrorDiv) {
                    loginErrorDiv.textContent = '';
                    loginErrorDiv.classList.remove('show');
                }
                if (loginLoadingDiv) loginLoadingDiv.classList.remove('show');
                // Asegurar que el bot√≥n est√© habilitado y con el texto correcto
                if (loginSubmitBtn) {
                    loginSubmitBtn.disabled = false;
                    loginSubmitBtn.textContent = 'Iniciar Sesi√≥n';
                }
            }
            
            // Funci√≥n para procesar el login desde el modal
            async function processLoginFromModal() {
                var loginEmailInput = document.getElementById('loginEmailInput');
                var loginPasswordInput = document.getElementById('loginPasswordInput');
                var loginErrorDiv = document.getElementById('loginModalError');
                var loginLoadingDiv = document.getElementById('loginModalLoading');
                var loginSubmitBtn = document.getElementById('loginSubmitBtn');
                
                var email = loginEmailInput ? loginEmailInput.value.trim() : '';
                var password = loginPasswordInput ? loginPasswordInput.value : '';
                
                // Validar campos
                if (!password) {
                    if (loginErrorDiv) {
                        loginErrorDiv.textContent = 'Por favor ingresa tu contrase√±a';
                        loginErrorDiv.classList.add('show');
                    }
                    return;
                }
                
                // Ocultar error y mostrar loading
                if (loginErrorDiv) loginErrorDiv.classList.remove('show');
                if (loginLoadingDiv) loginLoadingDiv.classList.add('show');
                if (loginSubmitBtn) {
                    loginSubmitBtn.disabled = true;
                    loginSubmitBtn.textContent = 'Iniciando sesi√≥n...';
                }
                
                try {
                    // Esperar a que authSystem est√© disponible
                    if (!window.authSystem) {
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                    
                    if (!window.authSystem) {
                        throw new Error('Sistema de autenticaci√≥n no disponible');
                    }
                    
                    // IMPORTANTE: Activar permiso ANTES de llamar a login()
                    // porque login() internamente llama a setSession() que es interceptado
                    if (window.permitirGuardarSesionEnInicio) {
                        window.permitirGuardarSesionEnInicio();

                    }
                    
                    // Intentar iniciar sesi√≥n

                    var result = await window.authSystem.login(email, password);

                    if (loginLoadingDiv) loginLoadingDiv.classList.remove('show');
                    if (loginSubmitBtn) {
                        loginSubmitBtn.disabled = false;
                        loginSubmitBtn.textContent = 'Iniciar Sesi√≥n';
                    }
                    
                    if (result.success) {
                        // Verificar que la sesi√≥n se haya guardado correctamente
                        let user = window.authSystem.getCurrentUser();
                        
                        if (!user) {
                            await new Promise(resolve => setTimeout(resolve, 200));
                            user = window.authSystem.getCurrentUser();
                        }
                        
                        if (!user) {
                            if (loginErrorDiv) {
                                loginErrorDiv.textContent = 'Error al guardar la sesi√≥n. Intenta nuevamente.';
                                loginErrorDiv.classList.add('show');
                            }
                            // Asegurar que el bot√≥n est√© habilitado
                            if (loginSubmitBtn) {
                                loginSubmitBtn.disabled = false;
                                loginSubmitBtn.textContent = 'Iniciar Sesi√≥n';
                            }
                            return;
                        }

                        // La sesi√≥n ya deber√≠a estar guardada por login(), pero verificamos
                        // No necesitamos llamar a setSession() de nuevo porque login() ya lo hizo
                        
                        // Esperar un momento adicional para asegurar que sessionStorage se sincronice
                        await new Promise(resolve => setTimeout(resolve, 300));
                        
                        // Verificar una vez m√°s antes de redirigir
                        const finalCheck = window.authSystem.getCurrentUser();
                        if (!finalCheck) {
                            if (loginErrorDiv) {
                                loginErrorDiv.textContent = 'Error cr√≠tico. Por favor recarga la p√°gina e intenta nuevamente.';
                                loginErrorDiv.classList.add('show');
                            }
                            // Asegurar que el bot√≥n est√© habilitado
                            if (loginSubmitBtn) {
                                loginSubmitBtn.disabled = false;
                                loginSubmitBtn.textContent = 'Iniciar Sesi√≥n';
                            }
                            return;
                        }
                        
                        // Si es administrador, ofrecer ir al panel de admin o a la biblioteca
                        if (user && user.rol === 'admin') {
                            if (confirm('¬øDeseas ir al Panel de Administraci√≥n?')) {
                                window.location.href = 'admin.html';
                            } else {
                                // Marcar que viene de login para permitir acceso a index.html
                                sessionStorage.setItem('vieneDeLogin', 'true');
                                window.location.href = 'index.html';
                            }
                        } else {
                            // Marcar que viene de login para permitir acceso a index.html
                            sessionStorage.setItem('vieneDeLogin', 'true');
                            window.location.href = 'index.html';
                        }
                    } else {
                        // Verificar si el error es por ban y si puede apelar
                        const banId = result.ban_id;
                        const puedeApelar = result.puede_apelar === true;

                        if (loginErrorDiv) {
                            loginErrorDiv.textContent = result.message || 'Correo o contrase√±a incorrectos';
                            loginErrorDiv.classList.add('show');

                        } else {

                        }
                        
                        // Si hay ban y puede apelar, redirigir autom√°ticamente a apelar
                        if (banId && puedeApelar) {

                            // Guardar informaci√≥n del ban para la p√°gina de apelaci√≥n
                            sessionStorage.setItem('ban_id_apelar', banId);
                            sessionStorage.setItem('email_apelar', email);
                            if (result.usuario_id) {
                                sessionStorage.setItem('usuario_id_apelar', result.usuario_id);
                            }
                            if (result.ban_motivo) {
                                sessionStorage.setItem('ban_motivo', result.ban_motivo);
                            }
                            if (result.ban_tipo) {
                                sessionStorage.setItem('ban_tipo', result.ban_tipo);
                            }
                            
                            // Determinar ruta correcta seg√∫n entorno
                            const currentUrl = window.location.href.toLowerCase();
                            const isHostinger = currentUrl.indexOf('hostinger') !== -1 || 
                                               currentUrl.indexOf('hostingersite.com') !== -1 ||
                                               currentUrl.indexOf('organicjournal.com.mx') !== -1;
                            
                            let apelarPath;
                            if (isHostinger) {
                                apelarPath = '/pages/apelar-ban.html';
                            } else {
                                // inicio.html est√° en /pages/, usar ruta relativa
                                apelarPath = 'apelar-ban.html';
                            }

                            // Redirigir autom√°ticamente
                            window.location.href = apelarPath;
                            return; // Salir para evitar mostrar el bot√≥n
                        }
                        
                        // Si hay ban pero NO puede apelar, solo mostrar mensaje
                        if (banId && !puedeApelar) {
                            // No mostrar bot√≥n, solo el mensaje de error que ya incluye la raz√≥n
                        }
                        
                        // Asegurar que el bot√≥n est√© habilitado
                        if (loginSubmitBtn) {
                            loginSubmitBtn.disabled = false;
                            loginSubmitBtn.textContent = 'Iniciar Sesi√≥n';

                        } else {

                        }
                        // Asegurar que el campo de contrase√±a est√© enfocado para facilitar reintento
                        if (loginPasswordInput) {
                            loginPasswordInput.focus();
                            loginPasswordInput.select();
                        }
                    }
                } catch (error) {

                    if (loginLoadingDiv) loginLoadingDiv.classList.remove('show');
                    if (loginSubmitBtn) {
                        loginSubmitBtn.disabled = false;
                        loginSubmitBtn.textContent = 'Iniciar Sesi√≥n';
                    }
                    if (loginErrorDiv) {
                        loginErrorDiv.textContent = 'Error de conexi√≥n. Intenta nuevamente.';
                        loginErrorDiv.classList.add('show');
                    }
                }
            }
            
            // Funci√≥n para verificar email y redirigir
            async function verifyEmailAndNavigate() {
                var emailInput = document.getElementById('emailInput');
                var errorDiv = document.getElementById('emailModalError');
                var loadingDiv = document.getElementById('emailModalLoading');
                var verifyBtn = document.getElementById('verifyEmailBtn');
                
                var email = emailInput.value.trim();
                
                // Validar email
                if (!email) {
                    errorDiv.textContent = 'Por favor ingresa tu correo electr√≥nico';
                    errorDiv.classList.add('show');
                    return;
                }
                
                var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    errorDiv.textContent = 'Por favor ingresa un correo electr√≥nico v√°lido';
                    errorDiv.classList.add('show');
                    return;
                }
                
                // VALIDAR CONTENIDO OFENSIVO EN EL EMAIL
                if (detectarContenidoOfensivoEnEmail(email)) {
                    errorDiv.textContent = 'El correo electr√≥nico contiene lenguaje ofensivo o inapropiado. Por favor usa un correo v√°lido sin contenido ofensivo.';
                    errorDiv.classList.add('show');
                    return;
                }
                
                // Ocultar error y mostrar loading
                errorDiv.classList.remove('show');
                loadingDiv.classList.add('show');
                verifyBtn.disabled = true;
                verifyBtn.textContent = 'Verificando...';
                
                try {
                    // Esperar a que authSystem est√© disponible
                    if (!window.authSystem) {
                        // Esperar un poco m√°s
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                    
                    // Verificar m√∫ltiples veces que authSystem y checkEmail est√©n disponibles
                    let attempts = 0;
                    while ((!window.authSystem || typeof window.authSystem.checkEmail !== 'function') && attempts < 5) {
                        await new Promise(resolve => setTimeout(resolve, 200));
                        attempts++;
                    }
                    
                    if (!window.authSystem) {
                        throw new Error('Sistema de autenticaci√≥n no disponible');
                    }
                    
                    if (typeof window.authSystem.checkEmail !== 'function') {
                        throw new Error('La funci√≥n checkEmail no est√° disponible. Verifica que auth.js se haya cargado correctamente.');
                    }
                    
                    // Verificar si el email existe

                    var result = await window.authSystem.checkEmail(email);

                    loadingDiv.classList.remove('show');
                    verifyBtn.disabled = false;
                    verifyBtn.textContent = 'Continuar';
                    
                    if (result.success) {
                        if (result.exists) {
                            // Email existe, mostrar formulario de login en el modal

                            showLoginView(email);
                        } else {
                            // Email no existe, ir a registro

                            navigateToRegistro(email);
                        }
                    } else {
                        // Error al verificar - puede ser contenido ofensivo detectado en el backend
                        if (result.contenido_ofensivo) {
                            errorDiv.textContent = result.message || 'El correo electr√≥nico contiene lenguaje ofensivo o inapropiado. Por favor usa un correo v√°lido sin contenido ofensivo.';
                        } else {
                            errorDiv.textContent = result.message || 'Error al verificar el correo. Intenta nuevamente.';
                        }
                        errorDiv.classList.add('show');
                    }
                } catch (error) {

                    loadingDiv.classList.remove('show');
                    verifyBtn.disabled = false;
                    verifyBtn.textContent = 'Continuar';
                    errorDiv.textContent = 'Error de conexi√≥n. Verifica que el servidor est√© corriendo.';
                    errorDiv.classList.add('show');
                }
            }
            
            // Configurar el bot√≥n y el modal cuando el DOM est√© listo
            function setupButtonAndModal() {
                var btn = document.getElementById('loginButton');
                var modal = document.getElementById('emailModal');
                var verifyBtn = document.getElementById('verifyEmailBtn');
                var cancelBtn = document.getElementById('cancelEmailBtn');
                var emailInput = document.getElementById('emailInput');
                
                if (!btn) {

                    setTimeout(setupButtonAndModal, 100);
                    return;
                }

                // Configurar click del bot√≥n de inicio de sesi√≥n
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();

                    showEmailModal();
                    return false;
                }, true);
                
                btn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();

                    showEmailModal();
                    return false;
                };
                
                // Configurar bot√≥n de verificar email
                if (verifyBtn) {
                    verifyBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        verifyEmailAndNavigate();
                    });
                }
                
                // Configurar bot√≥n de cancelar
                if (cancelBtn) {
                    cancelBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        hideEmailModal();
                    });
                }
                
                // Permitir Enter en el input de email
                if (emailInput) {
                    emailInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            verifyEmailAndNavigate();
                        }
                    });
                }
                
                // Configurar bot√≥n de login
                var loginSubmitBtn = document.getElementById('loginSubmitBtn');
                if (loginSubmitBtn) {
                    loginSubmitBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        processLoginFromModal();
                    });
                }
                
                // Configurar bot√≥n de volver
                var backToEmailBtn = document.getElementById('backToEmailBtn');
                if (backToEmailBtn) {
                    backToEmailBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        showEmailModal();
                    });
                }
                
                // Permitir Enter en el input de contrase√±a
                var loginPasswordInput = document.getElementById('loginPasswordInput');
                if (loginPasswordInput) {
                    loginPasswordInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            processLoginFromModal();
                        }
                    });
                }
                
                // Cerrar modal al hacer click fuera de √©l
                if (modal) {
                    modal.addEventListener('click', function(e) {
                        if (e.target === modal) {
                            hideEmailModal();
                        }
                    });
                }

            }
            
            // Ejecutar cuando el DOM est√© listo
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', setupButtonAndModal);
            } else {
                setupButtonAndModal();
            }
            
            // Tambi√©n ejecutar despu√©s de un peque√±o delay por si acaso
            setTimeout(setupButtonAndModal, 50);
        })();
        
        // Funci√≥n para detectar contenido ofensivo en email (validaci√≥n frontend)
        function detectarContenidoOfensivoEnEmail(email) {
            if (!email) return false;
            
            // Normalizar email: convertir a min√∫sculas y reemplazar n√∫meros/caracteres especiales comunes usados para camuflar
            var emailNormalizado = email.toLowerCase();
            emailNormalizado = emailNormalizado.replace(/0/g, 'o');
            emailNormalizado = emailNormalizado.replace(/1/g, 'i');
            emailNormalizado = emailNormalizado.replace(/3/g, 'e');
            emailNormalizado = emailNormalizado.replace(/4/g, 'a');
            emailNormalizado = emailNormalizado.replace(/5/g, 's');
            emailNormalizado = emailNormalizado.replace(/7/g, 't');
            emailNormalizado = emailNormalizado.replace(/@/g, 'a');
            emailNormalizado = emailNormalizado.replace(/\$/g, 's');
            emailNormalizado = emailNormalizado.replace(/!/g, 'i');
            emailNormalizado = emailNormalizado.replace(/\*/g, '');
            emailNormalizado = emailNormalizado.replace(/#/g, '');
            emailNormalizado = emailNormalizado.replace(/&/g, '');
            emailNormalizado = emailNormalizado.replace(/\+/g, '');
            emailNormalizado = emailNormalizado.replace(/=/g, '');
            emailNormalizado = emailNormalizado.replace(/_/g, '');
            emailNormalizado = emailNormalizado.replace(/-/g, '');
            emailNormalizado = emailNormalizado.replace(/\./g, '');
            // Remover caracteres especiales restantes
            emailNormalizado = emailNormalizado.replace(/[^a-z√°√©√≠√≥√∫√±√º]/gi, '');
            
            // Lista de palabras ofensivas comunes (misma que en el backend)
            var palabrasOfensivas = [
                'puta', 'puto', 'joder', 'jodido', 'jodida', 'jodete', 'jodanse',
                'joto', 'jota', 'jotos', 'jotas',
                'hijo de puta', 'hdp', 'cabron', 'cabr√≥n', 'cabrona', 'cabronazo',
                'mamada', 'mamadas', 'mam√≥n', 'mamona', 'mamones', 'mamar', 'mamando',
                'pinche', 'pinches', 'chingar', 'chingado', 'chingada', 'chingate',
                'verga', 'vergas', 'verguero', 'verguera',
                'pendejo', 'pendeja', 'pendejos', 'pendejas',
                'culero', 'culera', 'culeros', 'culeras',
                'maricon', 'maric√≥n', 'maricona', 'maricones',
                'culiar', 'coger', 'cojer', 'cojido', 'cojida',
                'chupar', 'chupada', 'chupadas', 'chupar verga', 'mamada de verga', 'mamar verga',
                'huevos', 'huev√≥n', 'huevona', 'huevones',
                'pito', 'pitos', 'pene', 'penes',
                'vagina', 'vaginas', 'co√±o', 'co√±os',
                'tetas', 'teta', 'chichis', 'chichi',
                'nalgas', 'nalga', 'culo', 'culos',
                'fuck', 'fucking', 'fucker', 'fuckers',
                'shit', 'shitting', 'shitter',
                'ass', 'asshole', 'assholes',
                'bitch', 'bitches', 'bitching',
                'bastard', 'bastards',
                'damn', 'damned',
                'hell', 'hells'
            ];
            
            // Buscar palabras ofensivas en el email original y normalizado
            for (var i = 0; i < palabrasOfensivas.length; i++) {
                var palabra = palabrasOfensivas[i].toLowerCase();
                
                // Para frases (palabras con espacios), buscar como substring
                if (palabra.indexOf(' ') !== -1) {
                    if (email.toLowerCase().indexOf(palabra) !== -1 || emailNormalizado.indexOf(palabra) !== -1) {
                        return true;
                    }
                }
                // Para palabras de 4 o m√°s caracteres, buscar como substring
                else if (palabra.length >= 4) {
                    if (email.toLowerCase().indexOf(palabra) !== -1 || emailNormalizado.indexOf(palabra) !== -1) {
                        return true;
                    }
                }
                // Para palabras cortas (3 caracteres o menos), buscar como palabra completa
                else {
                    var regex = new RegExp('\\b' + palabra + '\\b', 'i');
                    if (regex.test(email) || regex.test(emailNormalizado)) {
                        return true;
                    }
                }
            }
            
            return false;
        }

        // Funci√≥n para alternar visibilidad de contrase√±a
        function togglePassword(inputId, button) {
            var input = document.getElementById(inputId);
            if (input) {
                if (input.type === 'password') {
                    input.type = 'text';
                    button.textContent = 'üôà';
                    button.setAttribute('aria-label', 'Ocultar contrase√±a');
                } else {
                    input.type = 'password';
                    button.textContent = 'üëÅÔ∏è';
                    button.setAttribute('aria-label', 'Mostrar contrase√±a');
                }
            }
        }

        // Prevenir navegaci√≥n con las flechas del navegador (back/forward) - BLOQUEO COMPLETO
        (function() {
            var bloqueado = false;
            var urlInicio = window.location.href;
            
            // Funci√≥n para bloquear navegaci√≥n
            function bloquearNavegacion() {
                if (bloqueado) return;
                
                // Reemplazar la entrada actual del historial
                history.replaceState({page: 'inicio'}, null, urlInicio);
                
                // Agregar m√∫ltiples entradas al historial para bloquear ambas direcciones
                history.pushState({page: 'inicio'}, null, urlInicio);
                history.pushState({page: 'inicio'}, null, urlInicio);
                history.pushState({page: 'inicio'}, null, urlInicio);
            }
            
            // Bloquear inmediatamente al cargar
            bloquearNavegacion();
            bloqueado = true;
            
            // Bloquear cuando el documento est√© listo
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    bloquearNavegacion();
                    bloqueado = true;
                });
            } else {
                bloquearNavegacion();
                bloqueado = true;
            }
            
            // Bloquear despu√©s de delays para asegurar que se ejecute
            setTimeout(function() {
                bloquearNavegacion();
                bloqueado = true;
            }, 50);
            setTimeout(function() {
                bloquearNavegacion();
                bloqueado = true;
            }, 100);
            setTimeout(function() {
                bloquearNavegacion();
                bloqueado = true;
            }, 500);
            
            // Prevenir navegaci√≥n cuando el usuario intenta usar las flechas del navegador
            window.addEventListener('popstate', function(event) {
                // Volver a agregar entradas al historial inmediatamente ANTES de cualquier otra acci√≥n
                history.pushState({page: 'inicio'}, null, urlInicio);
                history.pushState({page: 'inicio'}, null, urlInicio);
                history.pushState({page: 'inicio'}, null, urlInicio);
                
                // Forzar que la p√°gina permanezca en inicio.html
                if (window.location.pathname.indexOf('inicio.html') === -1) {
                    window.location.replace(urlInicio);
                }
                
                // Prevenir cualquier acci√≥n adicional
                event.stopImmediatePropagation();
                
                return false;
            }, true); // Usar capture phase para interceptar ANTES que otros listeners
            
            // Interceptar cualquier cambio en la URL como respaldo adicional
            var lastUrl = window.location.href;
            setInterval(function() {
                var currentUrl = window.location.href;
                if (currentUrl !== lastUrl && currentUrl !== urlInicio && window.location.pathname.indexOf('inicio.html') === -1) {
                    window.location.replace(urlInicio);
                }
                lastUrl = window.location.href;
            }, 50);
            
            // Bloquear tambi√©n el evento hashchange
            window.addEventListener('hashchange', function(event) {
                event.preventDefault();
                event.stopImmediatePropagation();
                window.location.replace(urlInicio);
                return false;
            }, true);
        })();

        // Limpiar sesi√≥n peri√≥dicamente mientras estamos en inicio.html
        // Esto asegura que incluso si auth.js intenta guardar una sesi√≥n, se limpie
        (function() {
            function limpiarSesionEnInicio() {
                try {
                    sessionStorage.removeItem('current_session');
                    localStorage.removeItem('current_session');

                } catch (error) {

                }
            }
            
            // Limpiar inmediatamente
            limpiarSesionEnInicio();
            
            // Limpiar cuando el documento est√© completamente cargado
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', limpiarSesionEnInicio);
            } else {
                limpiarSesionEnInicio();
            }
            
            // Limpiar despu√©s de m√∫ltiples delays para asegurar que se ejecute despu√©s de auth.js
            setTimeout(limpiarSesionEnInicio, 100);
            setTimeout(limpiarSesionEnInicio, 500);
            setTimeout(limpiarSesionEnInicio, 1000);
            setTimeout(limpiarSesionEnInicio, 2000);
            setTimeout(limpiarSesionEnInicio, 3000);
            
            // Limpiar cuando la ventana recibe foco (por si el usuario vuelve a la pesta√±a)
            window.addEventListener('focus', limpiarSesionEnInicio);
            
            // Interceptar cualquier intento de guardar sesi√≥n mientras estamos en inicio.html
            // PERO permitir guardar cuando el usuario inicia sesi√≥n exitosamente desde el modal
            var originalSetSession = null;
            var permitirGuardarSesion = false; // Flag para permitir guardar sesi√≥n cuando el usuario inicia sesi√≥n
            
            var checkInterval = setInterval(function() {
                if (window.authSystem && window.authSystem.setSession) {
                    if (!originalSetSession) {
                        originalSetSession = window.authSystem.setSession;
                        window.authSystem.setSession = function(user) {
                            // Solo permitir guardar sesi√≥n si el flag est√° activado (usuario inici√≥ sesi√≥n)
                            if (permitirGuardarSesion) {

                                return originalSetSession.call(this, user);
                            } else {

                                // No guardar la sesi√≥n mientras estamos en inicio.html
                                return;
                            }
                        };

                    }
                }
            }, 100);
            
            // Permitir guardar sesi√≥n cuando el usuario inicia sesi√≥n desde el modal
            // Esto se activar√° en processLoginFromModal ANTES de llamar a login()
            window.permitirGuardarSesionEnInicio = function() {
                permitirGuardarSesion = true;

            };
            
            // Funci√≥n para resetear el permiso (se llama cuando se muestra el modal de nuevo)
            window.resetPermisoGuardarSesion = function() {
                permitirGuardarSesion = false;

            };
            
            // Limpiar el intervalo despu√©s de 10 segundos
            setTimeout(function() {
                clearInterval(checkInterval);
            }, 10000);
        })();
    </script>
    
    <!-- PWA Service Worker Registration -->
    <script src="../assets/js/pwa-register.js?v=2"></script>

</body>

</html>
